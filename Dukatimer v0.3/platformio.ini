; =============================================================================
; DUKATIMER v0.3 - platformio.ini
; Target: ESP32-S3-N16R8 (16MB QIO Flash, 8MB Octal PSRAM)
;
; OPTIMIERUNGEN (gegenüber Debug-Konfiguration):
;   1. PSRAM im OPI-Modus aktiviert  → 8MB zusätzlicher Speicher verfügbar
;   2. Flash im QIO-Modus            → maximale Flash-Bandbreite (4 Datenleitungen)
;   3. CPU 240 MHz / Flash 80 MHz    → volle Taktrate
;   4. Compiler -O3                  → Geschwindigkeitsoptimierung statt Größe (-Os)
;   5. S3-spezifische Flags          → bessere Codegen für Xtensa LX7
; =============================================================================

[env:esp32-s3-devkitc-1]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

; --- BOARD & CPU SETTINGS ---
; ESP32-S3 Xtensa LX7 Dual-Core @ 240 MHz, Flash @ 80 MHz Quad-I/O
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L

; --- SPEICHER-KONFIGURATION (N16R8) ---
; memory_type = qio_opi:
;   qio = Quad I/O Flash (4 Datenleitungen, doppelte Bandbreite vs. DIO)
;   opi = Octal SPI PSRAM (8 Datenleitungen, ~160 MB/s bei 80 MHz)
; Diese Kombination ist die schnellste für den N16R8 und wird vom
; ESP-IDF automatisch in die korrekte sdkconfig übersetzt.
board_build.arduino.memory_type = qio_opi
board_upload.flash_size = 16MB
board_upload.maximum_size = 16777216
board_build.partitions = default_16MB.csv

; --- COMPILER-OPTIMIERUNG ---
; Wechsel von -Os (Größe) auf -O3 (Geschwindigkeit):
;   - Aggressiveres Inlining → weniger Funktionsaufruf-Overhead
;   - Loop-Unrolling → schnellere NeoPixel-Buffer-Operationen
;   - Bessere Register-Nutzung → weniger Stack-Zugriffe
; Nachteil: ~10-20% größere Binary (bei 16MB Flash irrelevant)
build_unflags = -Os
build_flags = 
    ; --- Geschwindigkeitsoptimierung ---
    -O3

    ; --- PSRAM Aktivierung ---
    ; BOARD_HAS_PSRAM: Arduino-Framework erkennt PSRAM und aktiviert ps_malloc()
    ; CONFIG_SPIRAM: ESP-IDF PSRAM-Treiber (Kompatibilität mit älteren Frameworks)
    -D BOARD_HAS_PSRAM
    -D CONFIG_SPIRAM=1
    -D CONFIG_SPIRAM_SUPPORT=1

    ; --- USB-CDC Einstellungen ---
    ; USB_MODE=1: Nativer USB-OTG (nicht über UART-Bridge)
    ; CDC_ON_BOOT=1: Serial-Output geht über USB-CDC (kein externer UART nötig)
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_USB_CDC_ON_BOOT=1

lib_deps =
    https://github.com/Seeed-Studio/Grove_LCD_RGB_Backlight.git
    adafruit/Adafruit NeoPixel @ ^1.11.0
    adafruit/Adafruit TSL2591 Library @ ^1.4.3
    adafruit/Adafruit TSL2561 @ ^1.1.1
    adafruit/Adafruit Unified Sensor @ ^1.1.9
    milesburton/DallasTemperature @ ^3.11.0
    paulstoffregen/OneWire @ ^2.3.7
    madhephaestus/ESP32Encoder @ ^0.10.1
    adafruit/Adafruit BMP280 Library

upload_port = COM14